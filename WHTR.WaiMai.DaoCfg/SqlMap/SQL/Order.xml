<?xml version="1.0"?>
<sqlMap xmlns="http://ibatis.apache.org/mapping" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" namespace="Order">
  <alias>
    <typeAlias alias="Order" type="WHTR.WaiMai.Contracts.Models.Order, WHTR.WaiMai.Contracts" />
    <typeAlias alias="OrderViewModel" type="WHTR.WaiMai.Contracts.ViewModels.OrderViewModel, WHTR.WaiMai.Contracts" />
  </alias>
  <resultMaps>
    <resultMap id="SelectAllResult" class="Order">
      <result property="Id" column="Id" />
      <result property="FoodMenuId" column="FoodMenuId" />
      <result property="TotalCount" column="TotalCount" />
      <result property="TotalPrice" column="TotalPrice" />
      <result property="NickName" column="NickName" />
      <result property="CreateDate" column="CreateDate" />
      <result property="Creator" column="Creator" />
      <result property="EditDate" column="EditDate" />
      <result property="Editor" column="Editor" />
      <result property="IsDel" column="IsDel" />
      <result property="Version" column="Version" />
    </resultMap>
  </resultMaps>
  <statements>

    <select id="qryOrder" resultClass="OrderViewModel">
      SELECT od.Id,fm.MenuName,od.TotalCount,od.TotalPrice,od.NickName,od.CreateDate
      FROM [Order] od
      INNER JOIN FoodMenu AS fm ON od.FoodMenuId=fm.Id
      WHERE od.IsDel=0
    </select>

    <select id="qryOrderForToday" resultClass="OrderViewModel">
      SELECT od.Id,fm.MenuName,od.TotalCount,od.TotalPrice,od.NickName,od.CreateDate
      FROM [Order] od
      INNER JOIN FoodMenu AS fm ON od.FoodMenuId=fm.Id
      WHERE CONVERT(VARCHAR(10),od.Createdate,120)=CONVERT(VARCHAR(10),GETDATE(),120)
      AND od.IsDel=0
    </select>


    <insert id="insOrder" parameterclass="Order">
      insert into [Order](FoodMenuId,TotalCount,TotalPrice,NickName,CreateDate,Creator,EditDate,Editor,IsDel,Version)
      values (#FoodMenuId#,#TotalCount#,#TotalPrice#,#NickName#,#CreateDate#,#Creator#,#EditDate#,#Editor#,#IsDel#,#Version#)
      <selectKey  type="post" resultClass="int" property="Id">
        SELECT CAST(@@IDENTITY as int) as Id
      </selectKey>
    </insert>

    <delete id="delOrder" parameterclass="int">
      UPDATE [Order]
      SET IsDel = 1
      WHERE Id=#value#
    </delete>

  </statements>
</sqlMap>