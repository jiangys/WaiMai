@{
    ViewBag.Title = "菜单列表";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section head{
    <link href="~/Content/css/restaurant.css" rel="stylesheet" />

}
@section Scripts {
    <script>
        $(function () {
            $(".addbtn").click(function () {
                var id = $(this).attr("data-id");
                var menu = $(this).attr("data-menu");
                var price = $(this).attr("data-price");
                $(".confirm-info").text(menu + "/" + price);
                var elem = document.getElementById('confirm');
                var d = dialog({
                    title: '确定下单',
                    content: elem,
                    okValue: '提交订单',
                    ok: function () {
                        var nickName = $('#nickname').val();
                        if (!nickName || nickname == "") {
                            alert("请填写昵称");
                            return false;
                        }
                        $.post("/Order/add", { FoodMenuId: id, TotalPrice: price, NickName: nickName }, function (jsonData) {
                            $.procAjaxData(jsonData, function () {
                                window.location.href = jsonData.BackUrl;
                            });
                        });
                        this.close(value);
                        this.remove();
                    },
                    cancelValue: '取消',
                    cancel: function () { }
                });
                d.showModal();

            });


            // 窗口滚动的时候控制悬浮效果。
            var $category = $('.menu-categories');
            var categoryHook = $category.offset().top;
            $(window).scroll(function () {
                var scrollTop = $(window).scrollTop();
                if (scrollTop < categoryHook) {
                    $category.removeClass('menu-categories-fixed');
                    $('#category-menu-container .content-list').removeAttr('style');
                } else {
                    $category.addClass('menu-categories-fixed');
                    $('#category-menu-container .content-list').css('margin-top', $category.height() + 30 + 'px');
                }
            });
            //点击菜单类别
            $('.menu-categories li').click(function (e) {
                e.preventDefault();
                $('.menu-categories li').removeClass('active');
                $(this).addClass('active');
                var hashValue = $(this).find('a').data('href');
                var $hash = $(hashValue);
                var scrollTop = $hash.offset().top;
                $(window).scrollTop(scrollTop - $('.menu-categories').height() - 25);
            });
        });
    </script>
}
<section class="container">
    <div class="basicinfo u-border clearfix">
        @{
            var restaurantModel = ViewBag.RestaurantModel as WHTR.WaiMai.Contracts.ViewModels.RestaurantViewModel;
            <div class="b-img fl">
                <img width="120" height="120" src="~/Content/images/nopic_waimai.png">
            </div>
            <div class="b-info fl">
                <h3>@restaurantModel.RestaurantName</h3>
                <dl>
                    <dt><i class="icon-time"></i>订餐状态:&nbsp;</dt>
                    <dd>
                        @if (ViewBag.IsDo == true)
                        {
                            <strong class="doing">进行中</strong>
                        }
                        else
                        {
                            <strong class="stop">订餐结束</strong>
                        }
                    </dd>
                </dl>
                <dl>
                    <dt><i class="icon-time"></i>订餐电话:&nbsp;</dt>
                    <dd>
                        @restaurantModel.TakeoutPhone
                    </dd>
                </dl>
            </div>
            <div class="b-cost fr">
                <div class="b-value">¥<strong class="b-num">0</strong></div>
                <p class="b-label">配送费</p>
            </div>
            <div class="b-divider fr"></div>
            <div class="b-price fr">
                <div class="b-value"><strong class="b-num">@restaurantModel.SendOutCount</strong>份</div>
                <p class="b-label">起送份数</p>
            </div>
            <div class="b-divider fr"></div>
            <div class="b-totime fr">
                <div class="b-value">
                    <strong class="b-num">40分钟</strong>
                    <span class="num-unit"></span>
                </div>
                <p class="b-label">平均送达时间</p>
            </div>
        }
    </div>

    <div data-spy="scroll" data-target=".navbar-example">

        <div class="menu-categories clearfix">
            <h3>菜品分类：</h3>
            <ul class="list clearfix">
                @{
                    var foodMenuList = ViewBag.FoodMenuList as List<WHTR.WaiMai.Contracts.ViewModels.FoodMenuViewModel>;
                    var categoryList = foodMenuList.Select(m => new { m.FoodMenuCategoryId, m.CName }).Distinct().ToList();
                    foreach (var itemCategory in categoryList)
                    {
                        <li>
                            <a data-href="#category-anchor-@itemCategory.FoodMenuCategoryId" href="javascript:;">@itemCategory.CName</a>
                        </li>
                    }
                }
            </ul>
        </div>



        <div id="content-list" class="content-list">
            @{
                foreach (var itemCategory in categoryList)
                {
                    <div class="one-category-menus-container">
                        <a name="category-anchor-@itemCategory.FoodMenuCategoryId" id="category-anchor-@itemCategory.FoodMenuCategoryId"></a>
                        <h4 class="one-category-menu-title">@itemCategory.CName</h4>
                        <div class="one-category-menus ">
                            <div class="clearfix" id="imgBoxList">
                                @foreach (var item in foodMenuList.Where(m => m.FoodMenuCategoryId == itemCategory.FoodMenuCategoryId))
                                {
                                    <div class="item u-bgbox">
                                        <div class="pic fl">
                                            <img src="/Content/images/nopic_waimai.png">
                                        </div>
                                        <div class="item-detail fr">
                                            <div class="name">
                                                <a href="javascript:void(0)" title="">@item.MenuName</a>
                                            </div>
                                            <div class="item-desc">
                                                <span class="sale">0人推荐</span>
                                                <span class="sale-divider"></span>
                                                <span class="sale">已售 @item.TotalCount 份</span>
                                            </div>
                                            <div class="item-add clearfix">
                                                <div class="price fl">￥<i>@item.Price</i> / 份</div>
                                                @if (ViewBag.IsDo == true)
                                                {
                                                    <div class="addbtn fr" data-id="@item.Id" data-price="@item.Price" data-menu="@item.MenuName">
                                                        <span class="glyphicon glyphicon-plus-sign"></span>
                                                    </div>
                                                }
                                                else
                                                {
                                                    <div class="tips fr">已结束</div>
                                                    <div class="clear"></div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
            }
        </div>

    </div>
    <!--弹出确认信息框-->
    <div class="confirm" id="confirm" style="width:400px; display:none;">
        <blockquote>
            <p class="confirm-title">请确定您选择的订餐信息：</p>
            <p class="confirm-info"></p>
        </blockquote>
        <div class="form-group">
            <label>您的昵称：</label>
            <input class="form-control" id="nickname" placeholder="您的昵称">
        </div>
    </div>
    <!--结束 弹出确认信息框-->
</section>
